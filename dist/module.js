/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/ui","@grafana/data","@grafana/runtime","lodash","@emotion/css"],(function(e,t,n,a,r,o){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=6)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=a},function(e,t){e.exports=r},function(e,t){e.exports=o},function(e,t,n){"use strict";n.r(t);var a=n(2),r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function o(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var l=function(){return(l=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function i(e,t,n,a){return new(n||(n=Promise))((function(r,o){function l(e){try{c(a.next(e))}catch(e){o(e)}}function i(e){try{c(a.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,i)}c((a=a.apply(e,t||[])).next())}))}function c(e,t){var n,a,r,o,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,a&&(r=2&o[0]?a.return:o[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,o[1])).done)return r;switch(a=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,a=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(!(r=l.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){l=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){l.label=o[1];break}if(6===o[0]&&l.label<r[1]){l.label=r[1],r=o;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(o);break}r[2]&&l.ops.pop(),l.trys.pop();continue}o=t.call(e,l)}catch(e){o=[6,e],a=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}}function s(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var a,r,o=n.call(e),l=[];try{for(;(void 0===t||t-- >0)&&!(a=o.next()).done;)l.push(a.value)}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return l}var u=n(3),p=function(e){function t(t){var n=e.call(this,t)||this;return n.annotations={},n}return o(t,e),t.prototype.applyTemplateVariables=function(e,t){var n=Object(u.getTemplateSrv)();return l(l({},e),{spreadsheet:n.replace(e.spreadsheet,t),range:e.range?n.replace(e.range,t):""})},t.prototype.getSpreadSheets=function(){return i(this,void 0,Promise,(function(){return c(this,(function(e){return[2,this.getResource("spreadsheets").then((function(e){var t=e.spreadsheets;return t?Object.entries(t).map((function(e){var t=s(e,2),n=t[0];return{label:t[1],value:n}})):[]}))]}))}))},t}(u.DataSourceWithBackend),d=n(0),f=n.n(d),m=n(1);function h(e){var t=null==e?void 0:e.indexOf("/d/");if(!t)return{spreadsheet:e};var n=e.substring(t+3);return(t=n.indexOf("/"))&&(n=n.substring(0,t)),(t=e.indexOf("range="))>0?{spreadsheet:n,range:e.substring(t+"range=".length)}:{spreadsheet:n}}var g,y=function(e){return void 0===e&&(e=300),e<60?e+"s":e<3600?e/60+"m":e/3600+"h"},v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onRangeChange=function(e){t.props.onChange(l(l({},t.props.query),{range:e.target.value}))},t.onSpreadsheetIDChange=function(e){var n=t.props,a=n.query,r=n.onRunQuery,o=n.onChange;if(e.value){var i=e.value;/(.*)\/spreadsheets\/d\/(.*)/.test(i)?o(l(l({},a),h(i))):o(l(l({},a),{spreadsheet:i})),r()}},t.toggleUseTimeFilter=function(e){var n=t.props,a=n.query,r=n.onChange,o=n.onRunQuery;r(l(l({},a),{useTimeFilter:!a.useTimeFilter})),o()},t}return o(t,e),t.prototype.componentDidMount=function(){this.props.query.hasOwnProperty("cacheDurationSeconds")||(this.props.query.cacheDurationSeconds=300)},t.prototype.render=function(){var e,t,n=this.props,a=n.query,r=n.onRunQuery,o=n.onChange,i=n.datasource;return f.a.createElement(f.a.Fragment,null,f.a.createElement("div",{className:"gf-form-inline"},f.a.createElement(m.InlineFormLabel,{width:10,className:"query-keyword",tooltip:f.a.createElement("p",null,"The ",f.a.createElement("code",null,"spreadsheetId")," is used to identify which spreadsheet is to be accessed or altered. This ID is the value between the &quot/d/&quot and the &quot/edit&quot in the URL of your spreadsheet.")},"Spreadsheet ID"),f.a.createElement(m.SegmentAsync,{loadOptions:function(){return i.getSpreadSheets()},placeholder:"Enter SpreadsheetID",value:a.spreadsheet,allowCustomValue:!0,onChange:this.onSpreadsheetIDChange}),a.spreadsheet&&f.a.createElement(m.LinkButton,{style:{marginTop:1},variant:"link",icon:"link",href:(e=a,t="https://docs.google.com/spreadsheets/d/"+e.spreadsheet+"/view",e.range&&(t+="#range="+e.range),t),target:"_blank"}),f.a.createElement("div",{className:"gf-form gf-form--grow"},f.a.createElement("div",{className:"gf-form-label gf-form-label--grow"}))),f.a.createElement("div",{className:"gf-form-inline"},f.a.createElement(m.InlineFormLabel,{width:10,className:"query-keyword",tooltip:f.a.createElement("p",null,"A string like ",f.a.createElement("code",null,"Sheet1!A1:B2"),", that refers to a group of cells in the spreadsheet, and is typically used in formulas. Named ranges are also supported. When a named range conflicts with a sheet’s name, the named range is preferred.")},"Range"),f.a.createElement("input",{className:"gf-form-input width-14",value:a.range||"",placeholder:"ie: Class Data!A2:E",onChange:this.onRangeChange,onBlur:r}),f.a.createElement("div",{className:"gf-form gf-form--grow"},f.a.createElement("div",{className:"gf-form-label gf-form-label--grow"}))),f.a.createElement("div",{className:"gf-form-inline"},f.a.createElement(m.InlineFormLabel,{width:10,className:"query-keyword",tooltip:"Time in seconds that the spreadsheet will be cached in Grafana after receiving a response from the spreadsheet API"},"Cache Time"),f.a.createElement(m.Segment,{value:{label:y(a.cacheDurationSeconds),value:a.cacheDurationSeconds},options:[0,5,10,30,60,120,300,600,1800,3600,7200,18e3].map((function(e){return{label:y(e),value:e,description:e?"":"Response is not cached at all"}})),onChange:function(e){var t=e.value;return o(l(l({},a),{cacheDurationSeconds:t}))}}),f.a.createElement("div",{className:"gf-form gf-form--grow"},f.a.createElement("div",{className:"gf-form-label gf-form-label--grow"}))),f.a.createElement("div",{className:"gf-form-inline"},f.a.createElement(m.LegacyForms.Switch,{label:"Use Time Filter",labelClass:"width-10  query-keyword",tooltip:"Apply the dashboard time range to the first time field",checked:!0===a.useTimeFilter,onChange:this.toggleUseTimeFilter}),f.a.createElement("div",{className:"gf-form gf-form--grow"},f.a.createElement("div",{className:"gf-form-label gf-form-label--grow"}))))},t}(d.PureComponent);!function(e){e.JWT="jwt",e.KEY="key"}(g||(g={}));var E,b=[{label:"API Key (public spreadsheets)",value:g.KEY},{label:"Google JWT File (public and private spreadsheets)",value:g.JWT}],w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onResetApiKey=function(){var e=t.props.options;t.props.onOptionsChange(l(l({},e),{secureJsonData:l(l({},e.secureJsonData),{apiKey:""}),secureJsonFields:l(l({},e.secureJsonFields),{apiKey:!1})}))},t}return o(t,e),t.prototype.render=function(){var e=this.props,t=e.options,n=e.onOptionsChange,r=t.secureJsonFields,o=t.jsonData;o.hasOwnProperty("authType")||(o.authType=g.KEY);var i=t.secureJsonData;return f.a.createElement("div",{className:"gf-form-group"},f.a.createElement("div",{className:"gf-form"},f.a.createElement(m.InlineFormLabel,{className:"width-10",tooltip:"API Key auth is used to access public spreadsheets, and Google JWT File auth using a service account is used to access private files."},"Auth"),f.a.createElement(m.Select,{className:"width-30",value:b.find((function(e){return e.value===o.authType}))||b[0],options:b,defaultValue:o.authType,onChange:Object(a.onUpdateDatasourceJsonDataOptionSelect)(this.props,"authType")})),o.authType===g.KEY&&f.a.createElement(f.a.Fragment,null,f.a.createElement("div",{className:"gf-form"},f.a.createElement(m.LegacyForms.SecretFormField,{isConfigured:r&&r.apiKey,value:(null==i?void 0:i.apiKey)||"",label:"API Key",labelWidth:10,inputWidth:30,placeholder:"Enter API Key",onReset:this.onResetApiKey,onChange:Object(a.onUpdateDatasourceSecureJsonDataOption)(this.props,"apiKey")}))),o.authType===g.JWT&&f.a.createElement(T,{isConfigured:r&&!!r.jwt,onChange:function(e){n(l(l({},t),{secureJsonData:l(l({},i),{jwt:e})}))}}),f.a.createElement("div",{className:"grafana-info-box",style:{marginTop:24}},o.authType===g.JWT?f.a.createElement(f.a.Fragment,null,f.a.createElement("h4",null,"Generate a JWT file"),f.a.createElement("ol",{style:{listStylePosition:"inside"}},f.a.createElement("li",null,"Open the ",f.a.createElement("a",{href:"https://console.developers.google.com/apis/credentials"},"Credentials")," page in the Google API Console."),f.a.createElement("li",null,"Click ",f.a.createElement("strong",null,"Create Credentials")," then click ",f.a.createElement("strong",null,"Service account"),"."),f.a.createElement("li",null,"On the Create service account page, enter the Service account details."),f.a.createElement("li",null,"On the ",f.a.createElement("code",null,"Create service account")," page, fill in the ",f.a.createElement("code",null,"Service account details")," and then click ",f.a.createElement("code",null,"Create")),f.a.createElement("li",null,"On the ",f.a.createElement("code",null,"Service account permissions")," page, don’t add a role to the service account. Just click ",f.a.createElement("code",null,"Continue")),f.a.createElement("li",null,"In the next step, click ",f.a.createElement("code",null,"Create Key"),". Choose key type ",f.a.createElement("code",null,"JSON")," and click"," ",f.a.createElement("code",null,"Create"),". A JSON key file will be created and downloaded to your computer"),f.a.createElement("li",null,"Open the"," ",f.a.createElement("a",{href:"https://console.cloud.google.com/apis/library/sheets.googleapis.com?q=sheet"},"Google Sheets")," ","in API Library and enable access for your account"),f.a.createElement("li",null,"Open the"," ",f.a.createElement("a",{href:"https://console.cloud.google.com/apis/library/drive.googleapis.com?q=drive"},"Google Drive")," ","in API Library and enable access for your account. Access to the Google Drive API is used to list all spreadsheets that you have access to."),f.a.createElement("li",null,"Drag the file to the dotted zone above. Then click ",f.a.createElement("code",null,"Save & Test"),". The file contents will be encrypted and saved in the Grafana database."))):f.a.createElement(f.a.Fragment,null,f.a.createElement("h4",null,"Generate an API key"),f.a.createElement("ol",{style:{listStylePosition:"inside"}},f.a.createElement("li",null,"Open the ",f.a.createElement("a",{href:"https://console.developers.google.com/apis/credentials"},"Credentials page")," in the Google API Console."),f.a.createElement("li",null,"Click ",f.a.createElement("strong",null,"Create Credentials")," and then click ",f.a.createElement("strong",null,"API key"),"."),f.a.createElement("li",null,"Copy the key and paste it in the API Key field above. The file contents are encrypted and saved in the Grafana database.")))))},t}(d.PureComponent),C=n(5),O=n(4),S=["type","project_id","private_key_id","private_key","client_email","client_id","auth_uri","token_uri","auth_provider_x509_cert_url","client_x509_cert_url"];function T(e){var t=e.onChange,n=e.isConfigured,a=s(Object(d.useState)(!n),2),r=a[0],o=a[1],i=s(Object(d.useState)(),2),c=i[0],u=i[1],p=Object(m.useStyles2)(k);return r?f.a.createElement("div",{className:p.dropzone},f.a.createElement(m.FileDropzone,{options:{multiple:!1},onLoad:function(e){!function(e){return Object(O.isObject)(e)&&S.every((function(t){return!!e[t]}))}(JSON.parse(e))?u("Invalid JWT file"):(t(e),o(!1))},fileListRenderer:function(e,t){return c?f.a.createElement(m.FileListItem,{file:l(l({},e),{error:new DOMException(c)}),removeFile:t}):f.a.createElement(m.FileListItem,{file:e,removeFile:t})}})):f.a.createElement(f.a.Fragment,null,S.map((function(e){return f.a.createElement("div",{className:"gf-form",key:e},f.a.createElement(m.InlineFormLabel,{width:10},Object(O.startCase)(e)),f.a.createElement("input",{disabled:!0,className:"gf-form-input width-30",value:"configured"}))})),f.a.createElement(m.Button,{style:{marginTop:12},variant:"secondary",onClick:function(){return o(!0)}},"Upload another JWT file"))}function k(e){return{dropzone:Object(C.css)(E||(t=["\n      margin-top: ",";\n    "],n=["\n      margin-top: ",";\n    "],Object.defineProperty?Object.defineProperty(t,"raw",{value:n}):t.raw=n,E=t),e.spacing(2))};var t,n}var P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={index:0},t.renderInfo=function(e){var t,n=null===(t=e.meta)||void 0===t?void 0:t.custom;return n?f.a.createElement("div",null,f.a.createElement("h3",null,"Info"),f.a.createElement("pre",null,JSON.stringify(n,null,2))):null},t}return o(t,e),t.prototype.render=function(){var e=this,t=this.props.data;return t&&t.length?f.a.createElement("div",null,f.a.createElement("h3",null,"Google Sheets Metadata"),t.map((function(t){return e.renderInfo(t)}))):f.a.createElement("div",null,"No Data")},t}(d.PureComponent);n.d(t,"plugin",(function(){return I}));var I=new a.DataSourcePlugin(p).setConfigEditor(w).setQueryEditor(v).setMetadataInspector(P)}])}));
//# sourceMappingURL=module.js.map